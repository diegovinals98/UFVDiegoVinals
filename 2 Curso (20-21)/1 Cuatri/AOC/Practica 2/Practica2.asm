		output "binarios/banderas_verticales.bin" 
		org	$8000
		
		di
		ld ix,colores;
init: 
		ld sp,0
		ld c, 0;
		ld hl,$5800			
		
		push hl ;Guardar primera posición, 32 columnas a recorrer 24 veces
		jr bucle

nextFlag:
		ld b, 5 						
		call pausa 						
		jr init	



nextCol:
		pop hl; Recuperamos primera posicón de cada columna al terminar las 24 filas
		inc hl; Siguiente columna( en primera iteración será $5801)
		push hl;
		ld c,0

bucle:
				
		ld e,(ix); 
		inc ix
		ld a,e
		cp 222 ; fin de bandera
		jr z, nextFlag
		cp 254 ; fin de programa
		jr z, FIN

		sla e ;desplaza
		sla e
		sla e

		ld b,(ix)
		inc ix


		
RLEinner:
		;Sumar 32 al registro hl sin alterar el contador RLEinner
		push bc

		ld b,32 ;
		call IncHL ; En primera iteración pintaremos en 5832
		pop bc

		ld (hl),e
		inc c; contador salto de columna

		djnz RLEinner ;numero de veces que se repite el color(B)	
		
		ld a,c ;Contemplar salto de columna
		cp 24
		jr z, nextCol


		
		jr bucle


IncHL: 
	inc hl
	djnz IncHL
	ret

;; La función pausa de este programa está exportada de "banderas_extendidas.asm" by Daniel León

pausa: 	push af							; Salva registros utilizados en la pila
		push de

paus0:  ld de, 0 						; Inicializa DE a 0 para ciclar 2e16 (65536) en el bucle interno
paus1:	dec de 							; Decrementa DE. En la primera vuelta, DE valdrá 65535
		ld a,d 							; Para comprobar si DE es 0000, D tiene que ser 0...
		or e 							; ... y E también
		jr nz, paus1					; Si no lo es, sigue el bucle inteno
		djnz paus0                      ; B=B-1 y cicla a bucle externo hasta que B sea 0
		pop de 							; Recupera registros utilizados desde la pila
		pop af
		ret 

FIN: 
	JR FIN 

colores: 
		db 2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8
		db 2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8
		db 2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,2,8,6,8,2,8,222 ; ESPAÑA

		db 1,24,1,24,1,24,1,24,1,24,1,24,1,24,1,24,1,24,1,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,7,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,222; FRANCIA

		db 4,24,4,24,4,24,4,24,4,24,4,24,4,24,4,24
		db 2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,2,24,222;Portugal


		db 7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8
		db 1,24,1,24,1,24,1,24,1,24,1,24,1,24,1,24
		db 7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8
		db 7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,7,8,1,8,7,8,222 ;FINLANDIA

		db 1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8
		db 6,24,6,24,6,24,6,24,6,24,6,24,6,24,6,24
		db 1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8
		db 1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,1,8,6,8,1,8,222;Suecia


		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 1,12,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2
		db 2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,2,2,7,2,222,254	;USA


		
	
		
		
